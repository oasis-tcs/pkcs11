## Additional AES Mechanisms

+--------------------------------------+---------------------------------------------------+
|                                      | Functions                                         |
|                                      +-----+-----+------+-----+-------+-----+-----+------+
| Mechanism                            | ENC | SIG | SIGR |     | GENK  | WRP |     | ENCS |
|                                      |  &  |  &  |  &   | DIG |   &   |  &  | DRV |  &   |
|                                      | DEC | VER | VERR |     | GENKP | UWRP|     | DECS |
+======================================+:===:+:===:+:====:+:===:+:=====:+:===:+:===:+:====:+
| CKM_AES_GCM                          |  ✓  |     |      |     |       |  ✓  |     |      |
+--------------------------------------+-----+-----+------+-----+-------+-----+-----+------+
| CKM_AES_CCM                          |  ✓  |     |      |     |       |  ✓  |     |      |
+--------------------------------------+-----+-----+------+-----+-------+-----+-----+------+
| CKM_AES_GMAC                         |     |  ✓  |      |     |       |     |     |      |
+--------------------------------------+-----+-----+------+-----+-------+-----+-----+------+
table: Additional AES Mechanisms vs. Functions

### Definitions

Mechanisms:

- CKM_AES_GCM
- CKM_AES_CCM
- CKM_AES_GMAC

Generator Functions:

- CKG_NO_GENERATE
- CKG_GENERATE
- CKG_GENERATE_COUNTER
- CKG_GENERATE_RANDOM
- CKG_GENERATE_COUNTER_XOR

### AES-GCM Authenticated Encryption / Decryption

Generic GCM mode is described in [GCM]. To set up for AES-GCM use the following
process, where K (key) and AAD (additional authenticated data) are as described
in [GCM]. AES-GCM uses CK_GCM_PARAMS for Encrypt, Decrypt and
CK_GCM_MESSAGE_PARAMS for MessageEncrypt and MessageDecrypt.

Encrypt:

* Set the IV length _ulIvLen_ in the parameter block.
* Set the IV data _pIv_ in the parameter block.
* Set the AAD data _pAAD_ and size _ulAADLen_ in the parameter block. _pAAD_ may
  be NULL if _ulAADLen_ is 0.
* Set the tag length _ulTagBits_ in the parameter block.
* Call **C_EncryptInit** for **CKM_AES_GCM** mechanism with parameters and key
  _K_.
* Call **C_Encrypt**, or **C_EncryptUpdate**^1^ **C_EncryptFinal**, for the
  plaintext obtaining ciphertext and authentication tag output.

Decrypt:

* Set the IV length _ulIvLen_ in the parameter block.
* Set the IV data _pIv_ in the parameter block.
* Set the AAD data _pAAD_ and size _ulAADLen_ in the parameter block. _pAAD_ may
  be NULL if _ulAADLen_ is 0.
* Set the tag length _ulTagBits_ in the parameter block.
* Call **C_DecryptInit** for **CKM_AES_GCM** mechanism with parameters and key
  _K_.
* Call **C_Decrypt**, or **C_DecryptUpdate**^1^ **C_DecryptFinal**, for the
  ciphertext, including the appended tag, obtaining plaintext output. Note:
  since **CKM_AES_GCM** is an AEAD cipher, no data should be returned until
  **C_Decrypt** or **C_DecryptFinal**.

MessageEncrypt:

* Set the IV length _ulIvLen_ in the parameter block.
* Set _pIv_ to hold the IV data returned from **C_EncryptMessage** and
  **C_EncryptMessageBegin**. If _ulIvFixedBits_ is not zero, then the
  _ulIvFixedBits_ most significant bits of _pIV_ contain the fixed IV. If
  ivGenerator is set to **CKG_NO_GENERATE**, _pIv_ is an input parameter with
  the full IV.
* Set the _ulIvFixedBits_ and _ivGenerator_ fields in the parameter block. 
* Set the tag length _ulTagBits_ in the parameter block.
* Set _pTag_ to hold the tag data returned from **C_EncryptMessage** or the
  final **C_EncryptMessageNext**.
* Call **C_MessageEncryptInit** for **CKM_AES_GCM** mechanism key _K_.
* Call **C_EncryptMessage**, or **C_EncryptMessageBegin** followed by
  **C_EncryptMessageNext**^2^. The mechanism parameter is passed to all three of
  these functions.
* Call **C_MessageEncryptFinal** to close the message encryption.

MessageDecrypt:

* Set the IV length _ulIvLen_ in the parameter block.
* Set the IV data _pIv_ in the parameter block.
* The _ulIvFixedBits_ and _ivGenerator_ fields are ignored.
* Set the tag length _ulTagBits_ in the parameter block.
* Set the tag data pTag in the parameter block before **C_DecryptMessage** or the
  final **C_DecryptMessageNext**.
* Call **C_MessageDecryptInit** for **CKM_AES_GCM** mechanism key _K_.
* Call **C_DecryptMessage**, or **C_DecryptMessageBegin** followed by
  **C_DecryptMessageNext**^3^. The mechanism parameter is passed to all three of
  these functions.
* Call **C_MessageDecryptFinal** to close the message decryption.

In _pIv_ the least significant bit of the initialization vector is the rightmost
bit. _ulIvLen_ is the length of the initialization vector in bytes.

On MessageEncrypt, the meaning of _ivGenerator_ is as follows: 

**CKG_NO_GENERATE** means the IV is passed in on MessageEncrypt and no internal IV
generation is done. 

**CKG_GENERATE** means that the non-fixed portion of the IV is generated by the
module internally. The generation method is not defined. 

**CKG_GENERATE_COUNTER** means that the non-fixed portion of the IV is generated
by the module internally by use of an incrementing counter, the initial IV
counter is zero. 

**CKG_GENERATE_COUNTER_XOR** means that the non-fixed portion of the IV is xored
with a counter. The value of the non-fixed portion passed must not vary from
call to call. Like **CKG_GENERATE_COUNTER**, the counter starts at zero. 

**CKG_GENERATE_RANDOM** means that the non-fixed portion of the IV is generated
by the module internally using a PRNG. In any case the entire IV, including the
fixed portion, is returned in _pIV_.

Modules must implement **CKG_GENERATE**. Modules may also reject _ulIvFixedBits_
values which are too large. Zero is always an acceptable value for
_ulIvFixedBits_.

In Encrypt and Decrypt the tag is appended to the ciphertext and the least
significant bit of the tag is the rightmost bit and the tag bits are the
rightmost _ulTagBits_ bits. In MessageEncrypt the tag is returned in the _pTag_
field of CK_GCM_MESSAGE_PARAMS. In MesssageDecrypt the tag is provided by the
_pTag_ field of CK_GCM_MESSAGE_PARAMS. 

The key type for _K_ must be compatible with **CKM_AES_ECB** and the
**C_EncryptInit** / **C_DecryptInit** / **C_MessageEncryptInit** /
**C_MessageDecryptInit** calls shall behave, with respect to _K_, as if they
were called directly with **CKM_AES_ECB**, _K_ and NULL parameters.

### AES-GCM Authenticated Wrap / Unwrap

Generic GCM mode is described in [GCM]. To set up for AES-GCM use the following
process, where wK (wrapping key) and AAD (additional authenticated data) are as
described in [GCM]. AES-GCM uses CK_GCM_WRAP_PARAMS for WrapKey, UnwrapKey and
CK_GCM_MESSAGE_PARAMS for WrapKeyAuthenticated and UnwrapKeyAuthenticated. 

WrapKey:

* Set the IV length _ulIvLen_ in the parameter block.
* Set pIv to hold the IV data returned from **C_WrapKey**. If _ulIvFixedBits_ is
  not zero, then the _ulIvFixedBits_ most significant bits of pIV contain the
  fixed IV. If _ivGenerator_ is set to **CKG_NO_GENERATE**, _pIv_ is an input
  parameter with the full IV.
* Set the _ulIvFixedBits_ and _ivGenerator_ fields in the parameter block.
* Set the AAD data _pAAD_ and size _ulAADLen_ in the parameter block. _pAAD_ may
  be NULL if _ulAADLen_ is 0.
* Set the tag length _ulTagBits_ in the parameter block.
* Call **C_WrapKey** for **CKM_AES_GCM** mechanism with parameters and wrapping
  key _wK_ and key to be wrapped _K_, obtaining a wrapped key and authentication
  tag output.

UnwrapKey:

* Set the IV length _ulIvLen_ in the parameter block.
* Set the IV data _pIv_ in the parameter block.
* The _ulIvFixedBits_ and _ivGenerator_ fields are ignored.
* Set the AAD data _pAAD_ and size _ulAADLen_ in the parameter block. _pAAD_ may
  be NULL if _ulAADLen_ is 0.
* Set the tag length _ulTagBits_ in the parameter block.
* Call **C_UnwrapKey** for **CKM_AES_GCM** mechanism with parameters and
  wrapping key _K_, wrapped key and authenticated tag output from wrap, and
  template for the new key, obtaining a key handle. 

WrapKeyAuthenticated:

* Set the IV length _ulIvLen_ in the parameter block.
* Set _pIv_ to hold the IV data returned from **C_WrapKeyAuthenticated**. If
  _ulIvFixedBits_ is not zero, then the _ulIvFixedBits_ most significant bits of
  _pIV_ contain the fixed IV. If _ivGenerator_ is set to **CKG_NO_GENERATE**,
  _pIv_ is an input parameter with the full IV.
* Set the _ulIvFixedBits_ and _ivGenerator_ fields in the parameter block. 
* Set the tag length _ulTagBits_ in the parameter block.
* Set _pTag_ to hold the tag data returned from **C_WrapKeyAuthenticated**.
* Call **C_WrapKeyAuthenticated** for **CKM_AES_GCM** mechanism wrapping key
  _wK_. wrapped key, parameter and obtaining a wrapped key and authentication
  tag output in the parameter block.

UnwrapKeyAuthenticated:

* Set the IV length _ulIvLen_ in the parameter block.
* Set the IV data _pIv_ in the parameter block.
* The _ulIvFixedBits_ and _ivGenerator_ fields are ignored.
* Set the tag length _ulTagBits_ in the parameter block.
* Set the tag data _pTag_ in the parameter block.
* Call **C_UnwrapKeyAuthenticated** for **CKM_AES_GCM** mechanism, wrapping key
  _wK_, wrapped key and authenticated tag output from wrap, and template for the
  new key, obtaining a key handle.

In _pIv_ the least significant bit of the initialization vector is the rightmost
bit. _ulIvLen_ is the length of the initialization vector in bytes.

On WrapKeyAuthenticated, the meaning of _ivGenerator_ is as follows: 

**CKG_NO_GENERATE** means the IV is passed in on WrapKeyAuthenticated and no
internal IV generation is done. 

**CKG_GENERATE** means that the non-fixed portion of the IV is generated by the
module internally. The generation method is not defined. 

**CKG_GENERATE_COUNTER** means that the non-fixed portion of the IV is generated
by the module internally by use of an incrementing counter, the initial IV
counter is zero. 

**CKG_GENERATE_COUNTER_XOR** means that the non-fixed portion of the IV is xored
with a counter. The value of the non-fixed portion passed must not vary from
call to call. Like **CKG_GENERATE_COUNTER**, the counter starts at zero. 

**CKG_GENERATE_RANDOM** means that the non-fixed portion of the IV is generated
by the module internally using a PRNG. In any case the entire IV, including the
fixed portion, is returned in _pIV_.

Modules must implement **CKG_GENERATE**. Modules may also reject _ulIvFixedBits_
values which are too large. Zero is always an acceptable value for
_ulIvFixedBits_.

In WrapKey and UnwrapKey the tag is appended to the wrapped key and the least
significant bit of the tag is the rightmost bit and the tag bits are the
rightmost _ulTagBits_ bits. In WrapKeyAuthenticated the tag is returned in the
_pTag_ field of CK_GCM_MESSAGE_PARAMS. In UnwrapKeyAuthenticated the tag is
provided by the pTag field of CK_GCM_MESSAGE_PARAMS. 

### AES-CCM Authenticated Encryption / Decryption

For IPsec ([RFC 4309]) and also for use in ZFS encryption. Generic CCM mode is
described in [RFC 3610].  To set up for AES-CCM use the following process, where
_K_ (key), nonce and additional authenticated data are as described in [RFC
3610]. AES-CCM uses CK_CCM_PARAMS for Encrypt and Decrypt, and
CK_CCM_MESSAGE_PARAMS for MessageEncrypt and MessageDecrypt.

Encrypt:

* Set the message/data length _ulDataLen_ in the parameter block.
* Set the nonce length _ulNonceLen_ and the nonce data _pNonce_ in the parameter
  block. 
* Set the AAD data _pAAD_ and size _ulAADLen_ in the parameter block. _pAAD_ may
  be NULL if _ulAADLen_ is 0.
* Set the MAC length _ulMACLen_ in the parameter block.
* Call **C_EncryptInit** for **CKM_AES_CCM** mechanism with parameters and key
  _K_.
* Call **C_Encrypt**, **C_EncryptUpdate**, or **C_EncryptFinal**, for the
  plaintext obtaining the final ciphertext output and the MAC. The total length
  of data processed must be ulDataLen. The output length will be _ulDataLen_ +
  _ulMACLen_.

Decrypt:

* Set the message/data length _ulDataLen_ in the parameter block. This length
  must not include the length of the MAC that is appended to the ciphertext.
* Set the nonce length _ulNonceLen_ and the nonce data _pNonce_ in the parameter
  block. 
* Set the AAD data _pAAD_ and size _ulAADLen_ in the parameter block. _pAAD_ may
  be NULL if _ulAADLen_ is 0.
* Set the MAC length _ulMACLen_ in the parameter block.
* Call **C_DecryptInit** for **CKM_AES_CCM** mechanism with parameters and key
  _K_.
* Call **C_Decrypt**, **C_DecryptUpdate**, or **C_DecryptFinal**, for the
  ciphertext, including the appended MAC, obtaining plaintext output. The total
  length of data processed must be _ulDataLen_ + _ulMACLen_. Note: since
  **CKM_AES_CCM** is an AEAD cipher, no data should be returned until
  **C_Decrypt** or **C_DecryptFinal**.

MessaageEncrypt:

* Set the message/data length _ulDataLen_ in the parameter block.
* Set the nonce length _ulNonceLen_.
* Set _pNonce_ to hold the nonce data returned from **C_EncryptMessage** and
  **C_EncryptMessageBegin**. If _ulNonceFixedBits_ is not zero, then the most
  significant bits of _pNonce_ contain the fixed nonce. If nonceGenerator is
  set to **CKG_NO_GENERATE**, _pNonce_ is an input parameter with the full
  nonce.
* Set the _ulNonceFixedBits_ and nonceGenerator fields in the parameter block. 
* Set the MAC length _ulMACLen_ in the parameter block.
* Set _pMAC_ to hold the MAC data returned from **C_EncryptMessage** or the
  final **C_EncryptMessageNext**.
* Call **C_MessageEncryptInit** for **CKM_AES_CCM** mechanism key _K_.
* Call **C_EncryptMessage**, or **C_EncryptMessageBegin** followed by
  **C_EncryptMessageNext**^4^. The mechanism parameter is passed to all three
  functions.
* Call **C_MessageEncryptFinal** to close the message encryption.
* The MAC is returned in _pMac_ of the CK_CCM_MESSAGE_PARAMS structure. 

MessageDecrypt:

* Set the message/data length _ulDataLen_ in the parameter block.
* Set the nonce length _ulNonceLen_ and the nonce data _pNonce_ in the parameter
  block
* The _ulNonceFixedBits_ and nonceGenerator fields in the parameter block are
  ignored. 
* Set the MAC length _ulMACLen_ in the parameter block.
* Set the MAC data _pMAC_ in the parameter block before **C_DecryptMessage** or
  the final **C_DecryptMessageNext**.
* Call **C_MessageDecryptInit** for **CKM_AES_CCM** mechanism key _K_.
* Call **C_DecryptMessage**, or **C_DecryptMessageBegin** followed by
  **C_DecryptMessageNext**^5^. The mechanism parameter is passed to all three
  functions.
* Call **C_MessageDecryptFinal** to close the message decryption.

In _pNonce_ the least significant bit of the nonce is the rightmost bit.
_ulNonceLen_ is the length of the nonce in bytes.

On MessageEncrypt, the meaning of nonceGenerator is as follows: 

**CKG_NO_GENERATE** means the nonce is passed in on MessageEncrypt and no
internal nonce generation is done. 

**CKG_GENERATE** means that the non-fixed portion of the nonce is generated by
the module internally. The generation method is not defined. 

**CKG_GENERATE_COUNTER** means that the non-fixed portion of the nonce is
generated by the module internally by use of an incrementing counter, the
initial IV counter is zero. 

**CKG_GENERATE_COUNTER_XOR** means that the non-fixed portion of the IV is xored
with a counter. The value of the non-fixed portion passed must not vary from
call to call. Like **CKG_GENERATE_COUNTER**, the counter starts at zero. 

**CKG_GENERATE_RANDOM** means that the non-fixed portion of the nonce is
generated by the module internally using a PRNG. In any case the entire nonce,
including the fixed portion, is returned in _pNonce_.

Modules must implement **CKG_GENERATE**. Modules may also reject
_ulNonceFixedBits_ values which are too large. Zero is always an acceptable
value for _ulNonceFixedBits_.

In Encrypt and Decrypt the MAC is appended to the ciphertext and the least
significant byte of the MAC is the rightmost byte and the MAC bytes are the
rightmost _ulMACLen_ bytes. In MessageEncrypt the MAC is returned in the _pMAC_
field of CK_CCM_MESSAGE_PARAMS. In MesssageDecrypt the MAC is provided by the
_pMAC_ field of CK_CCM_MESSAGE_PARAMS. 

The key type for _K_ must be compatible with **CKM_AES_ECB** and the
**C_EncryptInit** / **C_DecryptInit** / **C_MessageEncryptInit** /
**C_MessageDecryptInit** calls shall behave, with respect to _K_, as if they
were called directly with **CKM_AES_ECB**, _K_ and NULL parameters.

### AES-CCM Authenticated Wrap / Unwrap

To set up for AES-CCM use the following process, where _K_ (key), nonce and
additional authenticated data are as described in [RFC 3610]. AES-CCM uses
CK_CCM_WRAP_PARAMS for WrapKey and UnwrapKey, and CK_CCM_MESSAGE_PARAMS for
WrapKeyAuthenticated and UnwrapKeyAuthenticated.

WrapKey:

* Set the message/data length _ulDataLen_ in the parameter block to zero. The
  token will determine the message/data length during the wrap operation based
  on the key being wrapped. Previous versions of the specification state that
  the application should populate this field. As such, tokens SHALL ignore any
  value provided in this field.
* Set the nonce length _ulNonceLen_ and the nonce data _pNonce_ in the parameter
  block. 
* Set pNonce to hold the nonce data returned from **C_WrapKey**. If
  _ulNonceFixedBits_ is not zero, then the most significant bits of _pNonce_
  contain the fixed nonce. If nonceGenerator is set to **CKG_NO_GENERATE**,
  _pNonce_ is an input parameter with the full nonce.
* Set the _ulNonceFixedBits_ and nonceGenerator fields in the parameter block. 
* Set the MAC length _ulMACLen_ in the parameter block.
* Call **C_WrapKey** for **CKM_AES_CCM** mechanism with parameters, wrapping key
  _wK_, key to be wrapped _mK_, obtaining the final wrapped key and the MAC. The
  total length of data processed must be ulDataLen. The output length will be
  _ulDataLen_ + _ulMACLen_.

UnwrapKey:

* Set the message/data length _ulDataLen_ to Zero in the parameter block. The
  token will get the ciphertext length from _ulWrappedKeyLen_.
* Set the nonce length _ulNonceLen_ and the nonce data _pNonce_ in the parameter
  block. 
* The _ulNonceFixedBits_ and nonceGenerator fields in the parameter block are
  ignored.
* Set the AAD data _pAAD_ and size _ulAADLen_ in the parameter block. _pAAD_ may
  be NULL if _ulAADLen_ is 0.
* Set the MAC length _ulMACLen_ in the parameter block.
* Call **C_UnwrapKey** for **CKM_AES_CCM** mechanism with parameters, unwrapping
  key _wK_, template, and wrapped key including the appended MAC, obtaining a
  new key handle.

WrapKeyAuthenticated:

* Set the message/data length _ulDataLen_ in the parameter block to zero, the
  length will be defined by the token based on the key being wrapped.
* Set the nonce length _ulNonceLen_.
* Set _pNonce_ to hold the nonce data returned from **C_WrapKeyAuthenticated**.
  If _ulNonceFixedBits_ is not zero, then the most significant bits of _pNonce_
  contain the fixed nonce. If nonceGenerator is set to **CKG_NO_GENERATE**,
  _pNonce_ is an input parameter with the full nonce.
* Set the _ulNonceFixedBits_ and nonceGenerator fields in the parameter block. 
* Set the MAC length _ulMACLen_ in the parameter block.
* Set _pMAC_ to hold the MAC data returned from **C_WrapKeyAuthenticated**.
* Call **C_WrapKeyAuthenticated** for **CKM_AES_CCM** mechanism with wrapping
  key _wK_, the key to be wrapped _mK_, and parameter block.
* The MAC is returned in pMac of the CK_CCM_MESSAGE_PARAMS structure. 

UnwrapKeyAuthenticated:

* Set the message/data length _ulDataLen_ to Zero in the parameter block.
* Set the nonce length _ulNonceLen_ and the nonce data _pNonce_ in the parameter
  block.
* The _ulNonceFixedBits_ and nonceGenerator fields in the parameter block are
  ignored. 
* Set the MAC length _ulMACLen_ in the parameter block.
* Set the MAC data _pMAC_ in the parameter block.
* Call **C_UnwrapKeyAuthenticated** for **CKM_AES_CCM** mechanism with
  unwrapping key _wK_, wrapped key _mK_, parameter block and template, obtaining
  a new key handle.

In _pNonce_ the least significant bit of the nonce is the rightmost bit.
_ulNonceLen_ is the length of the nonce in bytes.

On **C_WrapKeyAuthenticated** the meaning of nonceGenerator is as follows: 

**CKG_NO_GENERATE** means the nonce is passed in on WrapKeyAuthenticated and no
internal nonce generation is done. 

**CKG_GENERATE** means that the non-fixed portion of the nonce is generated by
the module internally. The generation method is not defined. 

**CKG_GENERATE_COUNTER** means that the non-fixed portion of the nonce is
generated by the module internally by use of an incrementing counter, the
initial IV counter is zero. 

**CKG_GENERATE_COUNTER_XOR** means that the non-fixed portion of the IV is xored
with a counter. The value of the non-fixed portion passed must not vary from
call to call. Like **CKG_GENERATE_COUNTER**, the counter starts at zero. 

**CKG_GENERATE_RANDOM** means that the non-fixed portion of the nonce is
generated by the module internally using a PRNG. In any case the entire nonce,
including the fixed portion, is returned in pNonce.

Modules must implement **CKG_GENERATE**. Modules may also reject
_ulNonceFixedBits_ values which are too large. Zero is always an acceptable
value for _ulNonceFixedBits_.

In WrapKey and UnwrapKey the MAC is appended to the ciphertext and the least
significant byte of the MAC is the rightmost byte and the MAC bytes are the
rightmost _ulMACLen_ bytes. In **C_WrapKeyAuthenticated** the MAC is returned in
the _pMAC_ field of CK_CCM_MESSAGE_PARAMS. In **C_UnwrapKeyAuthenticated** the
MAC is provided by the _pMAC_ field of CK_CCM_MESSAGE_PARAMS. 

### AES-GMAC

AES-GMAC, denoted CKM_AES_GMAC, is a mechanism for single and multiple-part
signatures and verification. It is described in NIST Special Publication 800-38D
[GMAC]. GMAC is a special case of GCM that authenticates only the Additional
Authenticated Data (AAD) part of the GCM mechanism parameters. When GMAC is used
with **C_Sign** or **C_Verify**, _pData_ points to the AAD. GMAC does not use
plaintext or ciphertext.

The signature produced by GMAC, also referred to as a Tag, the tag’s length is
determined by the CK_GCM_PARAMS field _ulTagBits_.

The IV length is determined by the CK_GCM_PARAMS field _ulIvLen_.

Constraints on key types and the length of data are summarized in the following
table:

| Function | Key type | Data length	| Signature length                   |
|----------|----------|-------------|------------------------------------|
| C_Sign   | AES | < 2^64^ | Depends on param’s ulTagBits |
| C_Verify | AES | < 2^64^ | Depends on param’s ulTagBits |
table: AES-GMAC: Key And Data Length

For this mechanism, the _ulMinKeySize_ and _ulMaxKeySize_ fields of the
**CK_MECHANISM_INFO** structure specify the supported range of AES key sizes, in
bytes.

### AES GCM and CCM Mechanism parameters

* **CK_GENERATOR_FUNCTION**

Functions to generate unique IVs and nonces.

~~~{.c}
typedef CK_ULONG CK_GENERATOR_FUNCTION;
~~~

* **CK_GCM_PARAMS; CK_GCM_PARAMS_PTR**

**CK_GCM_PARAMS** is a structure that provides the parameters to the
**CKM_AES_GCM** mechanism when used for Encrypt or Decrypt. It is defined as
follows:

~~~{.c}
typedef struct CK_GCM_PARAMS {
	CK_BYTE_PTR	pIv;
	CK_ULONG	ulIvLen;
	CK_ULONG	ulIvBits;
	CK_BYTE_PTR	pAAD;
	CK_ULONG	ulAADLen;
	CK_ULONG	ulTagBits;
}	CK_GCM_PARAMS;
~~~

The fields of the structure have the following meanings:

_pIv_
: pointer to initialization vector

_ulIvLen_
: length of initialization vector in bytes. The length of the initialization
vector can be any number between 1 and 2^32^ - 1. 96-bit (12 byte) IV values
can be processed more efficiently, so that length is recommended for situations
in which efficiency is critical.

_ulIvBits_
: length of initialization vector in bits. Do no use ulIvBits to specify the
length of the initialization vector, but ulIvLen instead.

_pAAD_
: pointer to additional authentication data. This data is authenticated but not
encrypted.

_ulAADLen_
: length of pAAD in bytes. The length of the AAD can be any number between 0 and
2^32^ – 1.

_ulTagBits_
: length of authentication tag (output following ciphertext) in bits. Can be any
value between 0 and 128.

**CK_GCM_PARAMS_PTR** is a pointer to a **CK_GCM_PARAMS**.

* **CK_GCM_MESSAGE_PARAMS; CK_GCM_MESSAGE_PARAMS_PTR**

**CK_GCM_MESSAGE_PARAMS** is a structure that provides the parameters to the
**CKM_AES_GCM** mechanism when used for MessageEncrypt or MessageDecrypt. It is
defined as follows:

~~~{.c}
typedef struct CK_GCM_MESSAGE_PARAMS {
	CK_BYTE_PTR	pIv;
	CK_ULONG	ulIvLen;
	CK_ULONG	ulIvFixedBits;
	CK_GENERATOR_FUNCTION	ivGenerator;
	CK_BYTE_PTR	pTag;
	CK_ULONG	ulTagBits;
}	CK_GCM_MESSAGE_PARAMS;
~~~

The fields of the structure have the following meanings:

_pIv_
: pointer to initialization vector

_ulIvLen_
: length of initialization vector in bytes. The length of the initialization
vector can be any number between 1 and 2^32^ - 1. 96-bit (12 byte) IV values
can be processed more efficiently, so that length is recommended for situations
in which efficiency is critical.

_ulIvFixedBits_
: number of bits of the original IV to preserve when generating an new IV. These
bits are counted from the Most significant bits (to the right).

_ivGenerator_
: Function used to generate a new IV. Each IV must be unique for a given
session.

_pTag_
: location of the authentication tag which is returned on MessageEncrypt, and
provided on MessageDecrypt.

_ulTagBits_
: length of authentication tag in bits. Can be any value between 0 and 128.

**CK_GCM_MESSAGE_PARAMS_PTR** is a pointer to a **CK_GCM_MESSAGE_PARAMS**.

* **CK_GCM_WRAP_PARAMS; CK_GCM_WRAP_PARAMS_PTR**

**CK_GCM_WRAP_PARAMS** is a structure that provides the parameters to the
**CKM_AES_GCM** mechanism when used for WrapKey to return a token generated IV
for input into UnwrapKey. It is defined as follows: 

~~~{.c}
typedef struct CK_GCM_WRAP_PARAMS {
	CK_BYTE_PTR	pIv;
	CK_ULONG	ulIvLen;
	CK_ULONG	ulIvFixedBits;
	CK_GENERATOR_FUNCTION	ivGenerator;
	CK_BYTE_PTR	pAAD;
	CK_ULONG	ulAADLen;
	CK_ULONG	ulTagBits;
}	CK_GCM_WRAP_PARAMS;
~~~

The fields of the structure have the following meanings:

_pIv_
: pointer to initialization vector

_ulIvLen_
: length of initialization vector in bytes. The length of the initialization
vector can be any number between 1 and 2^32^ - 1. 96-bit (12 byte) IV values
can be processed more efficiently, so that length is recommended for situations
in which efficiency is critical.

_ulIvFixedBits_
: number of bits of the original IV to preserve when generating an new IV. These
bits are counted from the Most significant bits (to the right).

_ivGenerator_
: Function used to generate a new IV. Each IV must be unique for a given
session.

_pAAD_
: pointer to additional authentication data. This data is authenticated but not
encrypted.

_ulAADLen_
: length of pAAD in bytes. The length of the AAD can be any number between 0 and
2^32^ – 1.

_ulTagBits_
: length of authentication tag in bits. Can be any value between 0 and 128.

**CK_GCM_WRAP_PARAMS_PTR** is a pointer to a **CK_GCM_WRAP_PARAMS**.

* **CK_CCM_PARAMS; CK_CCM_PARAMS_PTR**

**CK_CCM_PARAMS** is a structure that provides the parameters to the
**CKM_AES_CCM** mechanism when used for Encrypt or Decrypt. It is defined as
follows:

~~~{.c}
typedef struct CK_CCM_PARAMS {
	CK_ULONG	ulDataLen; /*plaintext or ciphertext*/
	CK_BYTE_PTR	pNonce;
	CK_ULONG	ulNonceLen;
	CK_BYTE_PTR	pAAD;
	CK_ULONG	ulAADLen;
	CK_ULONG	ulMACLen;
}	CK_CCM_PARAMS;
~~~

The fields of the structure have the following meanings, where L is the size in
bytes of the data length’s length (2 ≤ L ≤ 8):

_ulDataLen_
: length of the data where 0 ≤ ulDataLen < 2^8L^. 

_pNonce_
: the nonce.

_ulNonceLen_
: length of pNonce in bytes where 7 ≤ ulNonceLen ≤ 13.

_pAAD_
: Additional authentication data. This data is authenticated but not encrypted.

_ulAADLen_
: length of pAAD in bytes where 0 ≤ ulAADLen ≤ 2^32^ - 1.

_ulMACLen_
: length of the MAC (output following ciphertext) in bytes. Valid values are 4,
6, 8, 10, 12, 14, and 16.

**CK_CCM_PARAMS_PTR** is a pointer to a **CK_CCM_PARAMS**.

* **CK_CCM_MESSAGE_PARAMS; CK_CCM_MESSAGE_PARAMS_PTR**

**CK_CCM_MESSAGE_PARAMS** is a structure that provides the parameters to the
**CKM_AES_CCM** mechanism when used for MessageEncrypt or MessageDecrypt. It is
defined as follows:

~~~{.c}
typedef struct CK_CCM_MESSAGE_PARAMS {
	CK_ULONG	ulDataLen; /*plaintext or ciphertext*/
	CK_BYTE_PTR	pNonce;
	CK_ULONG	ulNonceLen;
	CK_ULONG	ulNonceFixedBits;
	CK_GENERATOR_FUNCTION	nonceGenerator;
	CK_BYTE_PTR	pMAC;
	CK_ULONG	ulMACLen;
}	CK_CCM_MESSAGE_PARAMS;
~~~

The fields of the structure have the following meanings, where L is the size in
bytes of the data length’s length (2 ≤ L ≤ 8):

_ulDataLen_
: length of the data where 0 ≤ ulDataLen < 2^8L^. 

_pNonce_
: the nonce.

_ulNonceLen_
: length of pNonce in bytes where 7 ≤ ulNonceLen ≤ 13.

_ulNonceFixedBits_
: number of bits of the original nonce to preserve when generating a new nonce.
These bits are counted from the Most significant bits (to the right).

_nonceGenerator_
: Function used to generate a new nonce. Each nonce must be unique for a given
session.

_pMAC_
: location of the CCM MAC returned on MessageEncrypt, provided on MessageDecrypt

_ulMACLen_
: length of the MAC (output following ciphertext) in bytes. Valid values are 4,
6, 8, 10, 12, 14, and 16.

**CK_CCM_MESSAGE_PARAMS_PTR** is a pointer to a **CK_CCM_MESSAGE_PARAMS**.

* **CK_CCM_WRAP_PARAMS; CK_CCM_WAP_PARAMS_PTR**

**CK_CCM_WRAP_PARAMS** is a structure that provides the parameters to the
**CKM_AES_CCM** mechanism when used for WrapKey only to provide a token
generated nonce and the number of bits to preserve. It is defined as follows: 

~~~{.c}
typedef struct CK_CCM_WRAP_PARAMS {
	CK_ULONG	ulDataLen; /*wrappedkey data*/
	CK_BYTE_PTR	pNonce;
	CK_ULONG	ulNonceLen;
	CK_ULONG	ulNonceFixedBits;
	CK_GENERATOR_FUNCTION	nonceGenerator;
	CK_BYTE_PTR	pAAD;
	CK_ULONG	ulAADLen;
	CK_ULONG	ulMACLen;
}	CK_CCM_WRAP_PARAMS;
~~~

The fields of the structure have the following meanings, where L is the size in
bytes of the data length’s length (2 ≤ L ≤ 8):

_ulDataLen_
: length of the data where 0 ≤ ulDataLen < 2^8L^. 

_pNonce_
: the nonce.

_ulNonceLen_
: length of pNonce in bytes where 7 ≤ ulNonceLen ≤ 13.

_ulNonceFixedBits_
: number of bits of the original nonce to preserve when generating a new nonce.
These bits are counted from the most significant bits (to the right).

_nonceGenerator_
: Function used to generate a new nonce. Each nonce must be unique for a given
session.

_pAAD_
: Additional authentication data. This data is authenticated but not wrapped.

_ulAADLen_
: length of pAAD in bytes where 0 ≤ ulAADLen ≤ 2^32^ - 1.

_ulMACLen_
: length of the MAC (output following ciphertext) in bytes. Valid values are 4,
6, 8, 10, 12, 14, and 16.

**CK_CCM_WRAP_PARAMS_PTR** is a pointer to a **CK_CCM_WRAP_PARAMS**.
